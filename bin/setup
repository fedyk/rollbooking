#!/usr/bin/env node
'use strict'

const { google } = require('googleapis');
const config = require('../built/lib/config')
const { authorize } = require('../built/lib/googleapis')

async function main() {
  const oAuth2Client = await authorize();
  const events = await listEvents(oAuth2Client);

  console.log('Google api is ready:', events);
}

/**
 * Lists the next 10 events on the user's primary calendar.
 * @param {google.auth.OAuth2} auth An authorized OAuth2 client.
 */
async function listEvents(auth) {
  const calendar = google.calendar({
    version: 'v3',
    auth
  });

  return new Promise((resolve, reject) => {
    calendar.events.list({
      calendarId: 'primary',
      timeMin: (new Date()).toISOString(),
      maxResults: 10,
      singleEvents: true,
      orderBy: 'startTime',
    }, (err, { data }) => {

      if (err) {
        return reject(err);
      }

      resolve(data.items);
    });
  })
}


try{
  main()
}
catch(e) {
  console.log(e);
}
